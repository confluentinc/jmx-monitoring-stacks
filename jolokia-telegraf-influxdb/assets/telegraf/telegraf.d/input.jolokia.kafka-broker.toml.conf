########## Kafka Broker ##########
[[inputs.jolokia2_agent]]

  # Add agents URLs to query
  urls = ["http://kafka1:8778/jolokia","http://kafka2:8779/jolokia"]
  default_field_separator = "."

  ##### java.lang #####

  [[inputs.jolokia2_agent.metric]]
    name = "java.lang_GarbageCollector"
    mbean = "java.lang:name=*,type=GarbageCollector"
    paths = ["CollectionTime","CollectionCount"]
    tag_keys = ["name"]

  [[inputs.jolokia2_agent.metric]]
    name = "java.lang_Memory"
    mbean = "java.lang:type=Memory"
    paths = ["ObjectPendingFinalizationCount","HeapMemoryUsage","NonHeapMemoryUsage"]

  [[inputs.jolokia2_agent.metric]]
    name = "java.lang_MemoryPool"
    mbean = "java.lang:name=*,type=MemoryPool"
    paths = ["Usage","PeakUsage","CollectionUsage"]
    tag_keys = ["name"]

  [[inputs.jolokia2_agent.metric]]
    name = "java.lang_OperatingSystem"
    mbean = "java.lang:type=OperatingSystem"
    paths = ["OpenFileDescriptorCount","CommittedVirtualMemorySize","FreePhysicalMemorySize","SystemLoadAverage","ProcessCpuLoad","FreeSwapSpaceSize","TotalPhysicalMemorySize","TotalSwapSpaceSize","ProcessCpuTime","MaxFileDescriptorCount","SystemCpuLoad","AvailableProcessors"]

  [[inputs.jolokia2_agent.metric]]
    name = "java.lang_Runtime"
    mbean = "java.lang:type=Runtime"
    paths = ["Uptime","StartTime"]

  [[inputs.jolokia2_agent.metric]]
    name = "java.lang_Threading"
    mbean = "java.lang:type=Threading"
    paths = ["TotalStartedThreadCount","CurrentThreadUserTime","PeakThreadCount","CurrentThreadCpuTime","ThreadCount","DaemonThreadCount"]


  ##### kafka.cluster #####

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.cluster_Partition"
    mbean = "kafka.cluster:name=*,partition=*,topic=*,type=Partition"
    field_name = "$1"
    tag_keys = ["topic","partition"]


  ##### kafka.log #####

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.log_Log"
    mbean = "kafka.log:name=*,partition=*,topic=*,type=Log"
    field_name = "$1"
    tag_keys = ["topic","partition"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.log_LogFlushStats"
    mbean = "kafka.log:name=LogFlushRateAndTimeMs,type=LogFlushStats"
    field_name = "LogFlushes"
    paths = ["Count"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.log_LogCleaner"
    mbean = "kafka.log:name=*,type=LogCleaner"
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.log_LogCleanerManager"
    mbean = "kafka.log:name=*,type=LogCleanerManager"
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.log_LogCleanerManager"
    mbean = "kafka.log:logDirectory=*,name=*,type=LogCleanerManager"
    field_name = "$2"
    tag_keys = ["logDirectory"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.log_LogManager"
    mbean = "kafka.log:name=*,type=LogManager"
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.log_LogManager"
    mbean = "kafka.log:logDirectory=*,name=*,type=LogManager"
    field_name = "$2"
    tag_keys = ["logDirectory"]


  ##### kafka.controller #####

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerChannelManager"
    mbean = "kafka.controller:name=TotalQueueSize,type=ControllerChannelManager"
    field_name = "TotalQueueSize"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerChannelManager"
    mbean = "kafka.controller:broker-id=*,name=QueueSize,type=ControllerChannelManager"
    field_name = "QueueSize"
    tag_keys = ["broker-id"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerChannelManager"
    mbean = "kafka.controller:broker-id=*,name=RequestRateAndQueueTimeMs,type=ControllerChannelManager"
    paths = ["Count"]
    field_name = "RequestCount"
    tag_keys = ["broker-id"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerEventManager"
    mbean = "kafka.controller:name=EventQueueSize,type=ControllerEventManager"
    field_name = "EventQueueSize"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerEventManager"
    mbean = "kafka.controller:name=EventQueueTimeMs,type=ControllerEventManager"
    paths = ["Count"]
    field_name = "EventCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=AutoLeaderBalanceRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "AutoLeaderBalanceCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=ControlledShutdownRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "ControlledShutdownCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=ControllerChangeRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "ControllerChangeCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=ControllerShutdownRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "ControllerShutdownCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=IsrChangeRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "IsrChangeCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=LeaderAndIsrResponseReceivedRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "LeaderAndIsrResponseReceivedCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=LeaderElectionRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "LeaderElectionCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=ListPartitionReassignmentRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "ListPartitionReassignmentCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=LogDirChangeRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "LogDirChangeCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=ManualLeaderBalanceRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "ManualLeaderBalanceCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=PartitionReassignmentRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "PartitionReassignmentCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=TopicChangeRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "TopicChangeCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=TopicDeletionRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "TopicDeletionCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=TopicUncleanLeaderElectionEnableRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "TopicUncleanLeaderElectionEnableCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=UncleanLeaderElectionEnableRateAndTimeMs,type=ControllerStats"
    paths = ["Count"]
    field_name = "UncleanLeaderElectionEnableCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_ControllerStats"
    mbean = "kafka.controller:name=UncleanLeaderElectionsPerSec,type=ControllerStats"
    paths = ["Count"]
    field_name = "UncleanLeaderElectionCount"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.controller_KafkaController"
    mbean = "kafka.controller:name=*,type=KafkaController"
    field_name = "$1"


  ##### kafka.network #####

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.network_RequestMetrics"
    mbean = "kafka.network:name=*,request=*,type=RequestMetrics"
    paths = ["Max","Mean"]
    field_prefix = "$1"
    tag_keys = ["request"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.network_RequestMetrics"
    mbean = "kafka.network:error=*,name=ErrorsPerSec,request=*,type=RequestMetrics"
    paths = ["Count"]
    field_name = "ErrorCount"
    tag_keys = ["error","request"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.network_RequestMetrics"
    mbean = "kafka.network:name=RequestsPerSec,request=*,type=RequestMetrics,version=*"
    paths = ["Count"]
    field_name = "RequestCount"
    tag_keys = ["request","version"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.network_RequestChannel"
    mbean = "kafka.network:name=*,type=RequestChannel"
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.network_RequestChannel"
    mbean = "kafka.network:name=*,processor=*,type=RequestChannel"
    field_name = "$1"
    tag_keys = ["processor"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.network_Processor"
    mbean = "kafka.network:name=*,networkProcessor=*,type=Processor"
    field_name = "$1"
    tag_keys = ["networkProcessor"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.network_Acceptor"
    mbean = "kafka.network:listener=*,name=AcceptorBlockedPercent,type=Acceptor"
    paths = ["OneMinuteRate"]
    field_name = "AcceptorBlockedPercent"
    tag_keys = ["listener"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.network_SocketServer"
    mbean = "kafka.network:name=*,type=SocketServer"
    field_name = "$1"


  ##### kafka.server #####

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_BrokerTopicMetrics"
    mbean = "kafka.server:name=*,type=BrokerTopicMetrics"
    paths = ["OneMinuteRate"]
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_BrokerTopicMetrics_topic"
    mbean = "kafka.server:name=*,topic=*,type=BrokerTopicMetrics"
    paths = ["OneMinuteRate"]
    field_name = "$1"
    tag_keys = ["topic"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_FetcherLagMetrics"
    mbean = "kafka.server:clientId=*,name=*,partition=*,topic=*,type=FetcherLagMetrics"
    field_name = "$2"
    tag_keys = ["clientId","topic","partition"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_ReplicaManager"
    mbean = "kafka.server:name=*,type=ReplicaManager"
    paths = ["OneMinuteRate","Value"]
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_DelayedOperationPurgatory"
    mbean = "kafka.server:delayedOperation=*,name=*,type=DelayedOperationPurgatory"
    field_name = "$2"
    tag_keys = ["delayedOperation"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_FetcherStats"
    mbean = "kafka.server:brokerHost=*,brokerPort=*,clientId=*,name=*,type=FetcherStats"
    paths = ["OneMinuteRate"]
    field_name = "$4"
    tag_keys = ["brokerHost","brokerPort","clientId"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_SessionExpireListener"
    mbean = "kafka.server:name=*,type=SessionExpireListener"
    paths = ["OneMinuteRate"]
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_DelayedFetchMetrics"
    mbean = "kafka.server:fetcherType=*,name=*,type=DelayedFetchMetrics"
    paths = ["OneMinuteRate"]
    field_name = "$2"
    tag_keys = ["fetcherType"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_ReplicaAlterLogDirsManager"
    mbean = "kafka.server:clientId=*,name=*,type=ReplicaAlterLogDirsManager"
    field_name = "$2"
    tag_keys = ["clientId"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_KafkaServer"
    mbean = "kafka.server:name=*,type=KafkaServer"
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_ReplicaFetcherManager"
    mbean = "kafka.server:clientId=*,name=*,type=ReplicaFetcherManager"
    field_name = "$2"
    tag_keys = ["clientId"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_FetchSessionCache"
    mbean = "kafka.server:name=*,type=FetchSessionCache"
    paths = ["OneMinuteRate","Value"]
    field_name = "$1"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_ZooKeeperClientMetrics"
    mbean = "kafka.server:name=ZooKeeperRequestLatencyMs,type=ZooKeeperClientMetrics"
    paths = ["Max","Mean"]
    field_prefix = "ZooKeeperRequestLatencyMs"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_KafkaRequestHandlerPool"
    mbean = "kafka.server:name=RequestHandlerAvgIdlePercent,type=KafkaRequestHandlerPool"
    paths = ["OneMinuteRate"]
    field_name = "RequestHandlerAvgIdlePercent"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_socket-server-metrics"
    mbean = "kafka.server:type=socket-server-metrics"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_socket-server-metrics_listener"
    mbean = "kafka.server:listener=*,networkProcessor=*,type=socket-server-metrics"
    tag_keys = ["listener","networkProcessor"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_socket-server-metrics_clientSoftware"
    mbean = "kafka.server:clientSoftwareName=*,clientSoftwareVersion=*,listener=*,networkProcessor=*,type=socket-server-metrics"
    tag_keys = ["clientSoftwareName","clientSoftwareVersion","listener","networkProcessor"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_replica-fetcher-metrics"
    mbean = "kafka.server:broker-id=*,fetcher-id=*,type=replica-fetcher-metrics"
    tag_keys = ["broker-id","fetcher-id"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_Fetch"
    mbean = "kafka.server:type=Fetch"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_LeaderReplication"
    mbean = "kafka.server:type=LeaderReplication"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_Produce"
    mbean = "kafka.server:type=Produce"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_Request"
    mbean = "kafka.server:type=Request"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_txn-marker-channel-metrics"
    mbean = "kafka.server:type=txn-marker-channel-metrics"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_group-coordinator-metrics"
    mbean = "kafka.server:type=group-coordinator-metrics"

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_controller-channel-metrics"
    mbean = "kafka.server:broker-id=*,type=controller-channel-metrics"
    tag_keys = ["broker-id"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.server_transaction-coordinator-metrics"
    mbean = "kafka.server:type=transaction-coordinator-metrics"


  ##### kafka.coordinator.group #####

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.coordinator.group_GroupMetadataManager"
    mbean = "kafka.coordinator.group:name=*,type=GroupMetadataManager"
    field_name = "$1"


  ##### kafka.coordinator.transaction #####

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.coordinator.transaction_TransactionMarkerChannelManager"
    mbean = "kafka.coordinator.transaction:name=*,type=TransactionMarkerChannelManager"
    field_name = "$1"


  ##### kafka.producer #####

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.producer_producer-metrics"
    mbean = "kafka.producer:client-id=*,type=producer-metrics"
    tag_keys = ["client-id"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.producer_producer-node-metrics"
    mbean = "kafka.producer:client-id=*,node-id=*,type=producer-node-metrics"
    tag_keys = ["client-id","node-id"]

  [[inputs.jolokia2_agent.metric]]
    name = "kafka.producer_producer-topic-metrics"
    mbean = "kafka.producer:client-id=*,topic=*,type=producer-topic-metrics"
    tag_keys = ["client-id","topic"]


  [inputs.jolokia2_agent.tags]
    environment = "dev"